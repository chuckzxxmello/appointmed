<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Appointment</title>

    <link rel="icon" href="../../../assets/images/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../../../assets/images/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="../../../assets/images/apple-touch-icon.png">
    <link rel="icon" sizes="96x96" href="../../../assets/images/favicon-96x96.png">
    <link rel="manifest" href="../../../assets/images/site.webmanifest">
      
    <meta name="theme-color" content="#ffd60a">
    <meta name="msapplication-TileImage" content="src/assets/images/web-app-manifest-192x192.png">
    <meta name="msapplication-TileColor" content="#ffd60a">

</head>
<body>
    
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- title -->    <title>Login</title>

<link rel="stylesheet" href="../../../styles/setappoint.css">

    <script type="module" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script> 
</head>

<body>

  <div class="bg-image"></div>

  <div class="header">
    <nav>
        <h2>ELAD School of Potentials Therapy Center</h2>
        <ul>
          <div class="dropdown-admin">
            <div class="dropdown-admin" onclick="window.location.href='../adminhome.html';">Admin Dashboard</div>
            <div class="dropdown-content-admin">
                <li><a href="setappoint.html">Manage Users</a></li>
                <li><a href="../../calendar/calendaredit.html">View Calendar</a></li>
                <li><a href="../analytics.html">Analytics</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </div>
        </div>
        </ul> 
    </nav>
  </div>  


  <div class="manage-user"> 
    <!-- Unique IDs for each button -->
    <button class="addel" id="addAppointmentButton">Add Appointment</button>
    <button class="addel" id="updateAppointmentButton">Update Appointment</button>
    <button class="addel" id="deleteAppointmentButton">Delete Appointment</button>
  </div>

  <div class="col-row-appoint">
    <script>
      // Event listeners for buttons to show respective forms
      document.getElementById("addAppointmentButton").addEventListener("click", function () {
          showForm("add");
      });
  
      document.getElementById("updateAppointmentButton").addEventListener("click", function () {
          showForm("update");
      });
  
      document.getElementById("deleteAppointmentButton").addEventListener("click", function () {
          showForm("delete");
      });
  
      // Function to handle the visibility of forms and tables
      function showForm(type) {
          var setForm = document.getElementById("setForm");
          var updateForm = document.getElementById("updateForm");
          var deleteForm = document.getElementById("deleteForm");
          var appointmentTable = document.getElementById("appointmentTable");
          var usersTable = document.getElementById("usersTable");
  
          // Reset all forms and tables to hidden
          setForm.style.display = "none";
          updateForm.style.display = "none";
          deleteForm.style.display = "none";
          appointmentTable.style.display = "none";
          if (usersTable) usersTable.style.display = "none";
  
          // Show the relevant form and tables based on the action type
          switch (type) {
              case "add":
                  setForm.style.display = "block";
                  appointmentTable.style.display = "block"; // Show appointment table only for adding an appointment
                  break;
              case "update":
                  updateForm.style.display = "block";
                  if (usersTable) usersTable.style.display = "block"; // Show users table for updating an appointment
                  break;
              case "delete":
                  deleteForm.style.display = "block";
                  if (usersTable) usersTable.style.display = "block"; // Show users table for deleting an appointment
                  break;
              default:
                  console.log("Invalid form type");
          }
      }
  
      // Event listener for "View Users" to show the users table and hide the appointment table
      document.getElementById("view_users").addEventListener("click", function() {
          var appointmentTable = document.getElementById("appointmentTable");
          var usersTable = document.getElementById("usersTable");
  
          // Hide the appointment table
          if (appointmentTable) appointmentTable.style.display = "none";
  
          // Show the users table
          if (usersTable) usersTable.style.display = "block";
      });
  
      // Event listener for "View Appointments" to show the appointment table and hide the users table
      document.getElementById("view_appointments").addEventListener("click", function() {
          var appointmentTable = document.getElementById("appointmentTable");
          var usersTable = document.getElementById("usersTable");
  
          // Show the appointment table
          if (appointmentTable) appointmentTable.style.display = "block";
  
          // Hide the users table
          if (usersTable) usersTable.style.display = "none";
      });
  </script>
  
  
  
    <form class="set" id="setForm" style="display:none;">
      <h2>Add an Appointment Schedule</h2>
      
      <div class="form-container">
        <!-- Left Column -->
        <div class="form-column">
          <label for="appointmentDate">Full Name of Client:</label>
          <input type="text" id="firstName" name="firstName" required placeholder="First Name">
          <input type="text" id="middleName" name="middleName" required placeholder="Middle Name">
          <input type="text" id="surname" name="surname" required placeholder="Last Name">
          
          <label for="email">Email</label>
          <input type="text" id="email" name="email" required placeholder="john.doe@gmail.com">
          
          <label for="contact">Phone Number</label>
          <input type="text" id="contact" name="contact" required placeholder="+63-XXX-XXXX-XXX">
          
          <label for="appointType">Type of Appointment</label>
          <select name="appointmentType">
            <option value=""></option>
            <option value="CONSULTATION">CONSULTATION</option>
            <option value="THERAPY">THERAPY</option>
            <option value="CHECK_UP">CHECK-UP</option>
            <option value="TRAINING_SESSION">TRAINING SESSION</option>
            <option value="COACHING">COACHING</option>
            <option value="DIAGNOSTIC">DIAGNOSTIC</option>
            <option value="TREATMENT">TREATMENT</option>
            <option value="FOLLOW_UP">FOLLOW-UP</option>
            <option value="INTERVIEW">INTERVIEW</option>
            <option value="SUPPORT">SUPPORT</option>
          </select>
        </div>
    
        <!-- Right Column -->
        <div class="form-column">
          <label for="doctor">Doctor</label>
          <input type="text" name="doctor" placeholder="Doctor's Name">    
          
          <label for="appointmentDate">Select Date:</label>
          <input type="date" id="appointmentDate" name="appointmentDate" required>
          
          <label for="appointmentTime">Select Time: (Start to End of Appointment)</label>
          <input type="time" id="appointmentTime" name="appointmentTimeStart" required>
          <input type="time" id="appointmentTime" name="appointmentTimeEnd" required>
          
          <label for="paymentType">Payment Method</label>
          <select name="paymentType" required>
            <option value=""></option>
            <option value="BANK_TRANSFER">BANK_TRANSFER</option>
            <option value="ONLINE_PAYMENT">ONLINE_PAYMENT</option>
            <option value="CASH">CASH</option>
            <option value="OTHER">OTHER</option>
          </select>
          
          <label for="payment">Cost of Appointment</label>
          <input type="number" name="payment" required placeholder="Amount in PHP">
          
          <label for="paymentStatus">Payment Status</label>
          <select name="paymentStatus" required>
            <option value=""></option>
            <option value="PAID">PAID</option>
            <option value="NOT_PAID">NOT_PAID</option>
            <option value="PARTIALLY_PAID">PARTIALLY_PAID</option>
            <option value="PENDING">PENDING</option>
            <option value="REFUNDED">REFUNDED</option>
            <option value="CANCELLED">CANCELLED</option>
            <option value="ON_HOLD">ON_HOLD</option>
          </select>
          
          <label for="appointmentStatus">Appointment Status</label>
          <select name="appointmentStatus" required>
            <option value=""></option>
            <option value="PENDING">PENDING</option>
            <option value="FINISHED">FINISHED</option>
            <option value="CANCELLED">CANCELLED</option>
            <option value="NO_SHOW">NO_SHOW</option>
            <option value="RESCHEDULED">RESCHEDULED</option>
            <option value="CONFIRMING">CONFIRMING</option>
            <option value="OVERDUE">OVERDUE</option>
          </select>
        </div>
      </div>
    
      <br>
      <button class="roundedbutton">Add Appointment</button>
    </form>

<!-- Update Appointment Form -->
<form class="update-form" id="updateForm" style="display:none;"> <!-- UPDATE -->
  <h2>Update Appointment Schedule</h2>

  <div class="form-container">
    <div class="form-column">
      <label for="appointmentDate">User UID:</label>
  <input type="text" name="id" required placeholder="Appointment ID">
  <label for="appointmentDate">Full Name of Client:</label>
  <input type="text" id="firstName" name="firstName" placeholder="First Name">
  <input type="text" id="middleName" name="middleName" placeholder="Middle Name">
  <input type="text" id="surname" name="surname" placeholder="Last Name" >
  <label for="email">Email</label>
  <input type="text" id="email" name="email"  placeholder="john.doe@gmail.com">
  <label for="contact">Phone Number</label>
  <input type="text" id="contact" name="contact"  placeholder="+63-XXX-XXXX-XXX">

  <!-- Dropdown for Type of Appointment -->
  <label for="appointType">Type of Appointment</label>
  <select name="appointmentType" >
    <option value=""></option>
    <option value="CONSULTATION">CONSULTATION</option>
    <option value="THERAPY">THERAPY</option>
    <option value="CHECK_UP">CHECK-UP</option>
    <option value="TRAINING_SESSION">TRAINING_SESSION</option>
    <option value="COACHING">COACHING</option>
    <option value="DIAGNOSTIC">DIAGNOSTIC</option>
    <option value="TREATMENT">TREATMENT</option>
    <option value="FOLLOW_UP">FOLLOW_UP</option>
    <option value="INTERVIEW">INTERVIEW</option>
    <option value="SUPPORT">SUPPORT</option>
  </select>
</div>

<div class="form-column">
  <label for="doctor">Doctor</label>
  <input type="text" name="doctor" placeholder="Doctor's Name">
  <label for="appointmentDate">Select Date:</label>
  <input type="date" id="appointmentDate" name="appointmentDate" >
  <label for="appointmentTime">Select Time: (Start to End of Appointment)</label>
  <input type="time" id="appointmentTime" name="appointmentTimeStart" >
  <input type="time" id="appointmentTime" name="appointmentTimeEnd" >

  <!-- Dropdown for Payment Method -->
  <label for="paymentType">Payment Method</label>
  <select name="paymentType" >
    <option value=""></option>
    <option value="BANK_TRANSFER">BANK_TRANSFER</option>
    <option value="ONLINE_PAYMENT">ONLINE_PAYMENT</option>
    <option value="CASH">CASH</option>
    <option value="OTHER">OTHER</option>
  </select>

  <label for="payment">Cost of Appointment</label>
  <input type="number" name="payment"  placeholder="Amount in PHP">

  <!-- Dropdown for Payment Status -->
  <label for="paymentStatus">Payment Status</label>
  <select name="paymentStatus" >
    <option value=""></option>
    <option value="PAID">PAID</option>
    <option value="NOT_PAID">NOT_PAID</option>
    <option value="PARTIALLY_PAID">PARTIALLY_PAID</option>
    <option value="PENDING">PENDING</option>
    <option value="REFUNDED">REFUNDED</option>
    <option value="CANCELLED">CANCELLED</option>
    <option value="ON_HOLD">ON_HOLD</option>
  </select>

  <!-- Dropdown for Appointment Status -->
  <label for="appointmentStatus">Appointment Status</label>
  <select name="appointmentStatus" >
    <option value=""></option>
    <option value="PENDING">PENDING</option>
    <option value="FINISHED">FINISHED</option>
    <option value="CANCELLED">CANCELLED</option>
    <option value="NO_SHOW">NO_SHOW</option>
    <option value="RESCHEDULED">RESCHEDULED</option>
    <option value="CONFIRMING">CONFIRMING</option>
    <option value="OVERDUE">OVERDUE</option>
  </select>
</div>
  <br><br>
  <button class="roundedbutton">Update</button>
</form>


</div>

    <!-- Delete Appointment Form -->
    <form class="deleteappoint" id="deleteForm" style="display:none;"> <!-- DELETE -->
      <h2>Delete Appointment from Database</h2>
      
      <label for="id">Appointment ID</label>
      <input type="text" name="id">
      <br><br>
      <button class="deletes">Delete from Database</button>
    </form>
  </div>
</div>
  
<table class="view-table" id="appointmentTable" border="3" style="display: none;">
  <thead>
      <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Full Name</th>
          <th>Phone Number</th>
          <th>Date</th>
          <th>TimeStart</th>
          <th>TimeEnd</th>
          <th>Type of Appointment</th>
          <th>Type of Payment</th>
          <th>Appointment Status</th>
          <th>Payment Status</th>
          <th>Cost</th>
          <th>Doctor</th>
      </tr>
  </thead>
  <tbody>
      <!-- Appointment data rows will be inserted here -->
  </tbody>
</table>

<div class="manage-user"> 
  <button type="button" class="user" id="view_users">Users</button>
  <button type="button" class="user" id="view_appointments">Appointments</button>
</div>

    <div class="footer"> 
        <div class="social-links">
            <a href="https://www.facebook.com/ELADSchoolofPotentials" class="footer-style-button">Facebook</a>
        </div>
        <p>&copy; 2025 ELAD School of Potentials Therapy Center</p>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"; 
    
        const firebaseConfig = {
          apiKey: "AIzaSyCZfi1aIc3zDdZD7NR7kN2Jm4hnCtPHWcQ",
          authDomain: "appointment-scheduling-s-57d01.firebaseapp.com",
          databaseURL: "https://appointment-scheduling-s-57d01-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "appointment-scheduling-s-57d01",
          storageBucket: "appointment-scheduling-s-57d01.firebasestorage.app",
          messagingSenderId: "1069885306589",
          appId: "1:1069885306589:web:b31768194add4087754d34",
          measurementId: "G-KQ4PQZZZBM"
        };
    
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
    
        function updateDropdownEmail(user) {
          const emailButton = document.getElementById('emailBtn');
          const userDropdown = document.getElementById('userDropdown');
          if (user) {
            emailButton.textContent = user.email;
            emailButton.onclick = () => { 
              if (userDropdown.style.display === 'block') {
                userDropdown.style.display = 'none';
              } else {
                userDropdown.style.display = 'block';
              }
            };
          } else {
            emailButton.textContent = "Login";
            emailButton.onclick = () => {
              window.location.href = '../login.html';
            };
          }
        }
    
        onAuthStateChanged(auth, (user) => {
          if (user) {
            updateDropdownEmail(user);
    
            user.reload()
              .then(() => {
                const verifyBtn = document.getElementById('verifyBtn');
                if (user.emailVerified) {
                  verifyBtn.textContent = "Email Verified";
                  verifyBtn.removeAttribute('href');
                } else {
                  verifyBtn.textContent = "Verify E-mail";
                  verifyBtn.href = "#";
                }
    
                console.log("Logged in:", user.email);
                console.log("Verified:", user.emailVerified);
              })
              .catch((error) => {
                console.log("Error reloading user:", error);
              });
    
          } else {
            updateDropdownEmail(null); 
          }
        });
    
        const signOutUser = () => {
          signOut(auth)
            .then(() => {
              console.log('Signed out successfully');
              window.location.href = '../../../pages/auth/login.html'; 
            })
            .catch((error) => {
              console.log('Error signing out:', error);
              alert("Error: " + error.message);
            });
        };
    
        const verifyEmail = () => {
          const user = auth.currentUser;
          if (user) {
            sendEmailVerification(user)
              .then(() => {
                alert("Verification email sent!");
              })
              .catch((error) => {
                console.log('Error sending verification email:', error);
                alert("Error: " + error.message); 
              });
          }
        };
    
        document.getElementById('logoutBtn').addEventListener('click', signOutUser);
        document.getElementById('verifyBtn').addEventListener('click', verifyEmail); 
    
        const loginBtn = document.getElementById('loginBtn');
        loginBtn.onclick = () => {
          const user = auth.currentUser; 
          if (user) {
            window.location.href = 'auth/userprofile.html'; 
          } else {
            window.location.href = 'auth/login.html'; 
          }
        };

        
      </script>

<script type="module">
  // Function to convert 24-hour time format to 12-hour format
  function convertTo12HourFormat(time24) {
    if (!time24) return '';
    const [hours, minutes] = time24.split(':');
    const hour = parseInt(hours, 10);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const hour12 = hour % 12 || 12;
    return `${hour12}:${minutes} ${ampm}`;
  }

  // Function to toggle columns visibility in the table
  function toggleColumns(columnsToShow) {
    const table = document.getElementById('appointmentTable');
    const headerRow = table.querySelector('thead tr');
    const bodyRows = table.querySelectorAll('tbody tr');

    const headers = Array.from(headerRow.querySelectorAll('th'));

    // Reset all columns to visible
    headers.forEach((header, index) => {
        header.style.display = '';
        bodyRows.forEach(row => {
            row.querySelectorAll('td')[index].style.display = '';
        });
    });

    // If no specific columns are specified, show all
    if (columnsToShow.length === 0) return;

    // Hide columns not in the specified list
    headers.forEach((header, index) => {
        if (!columnsToShow.some(col => header.textContent.trim().toLowerCase().includes(col.toLowerCase()))) {
            header.style.display = 'none';
            bodyRows.forEach(row => {
                row.querySelectorAll('td')[index].style.display = 'none';
            });
        }
    });
  }

  // Event listener for viewing users
  document.getElementById('view_users').addEventListener('click', () => {
    toggleColumns(['ID', 'Email', 'Full Name', 'Phone Number']);
    
    // Get the appointment table element by its ID
    const appointmentTable = document.getElementById('appointmentTable');
    
    // Change its display property to "block"
    if (appointmentTable) {
        appointmentTable.style.display = 'block';
    }
  });

  // Show the update form first, if needed
  document.getElementById('updateForm').style.display = 'block';

  // Fixing the typo here, changing ddocument to document
  document.getElementById('view_appointments').addEventListener('click', () => {
    toggleColumns([
        'name', 
        'date', 
        'timestart', 
        'timeend', 
        'type of appointment', 
        'appointment status', 
        'doctor',
        'type of payment',
        'payment status',
        'cost'
    ]);

    const appointmentTable = document.getElementById('appointmentTable');
    if (appointmentTable) {
        appointmentTable.style.display = 'block';
    }
  });

  // Function to print the table with appointment data
  function printTable(appointments) {
    const table = document.getElementById('appointmentTable');
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';

    appointments.forEach((data) => {
        const fullName = `${data.firstName || ''} ${data.middleName || ''} ${data.surname || ''}`.trim();
        const row = `
            <tr>
                <td>${data.id || ''}</td>
                <td>${data.email || ''}</td>
                <td>${fullName}</td>
                <td>${data.contact || ''}</td>
                <td>${data.appointmentDate || ''}</td>
                <td>${convertTo12HourFormat(data.appointmentTimeStart) || ''}</td>
                <td>${convertTo12HourFormat(data.appointmentTimeEnd) || ''}</td>
                <td>${data.appointmentType || ''}</td>
                <td>${data.paymentType || ''}</td>
                <td>${data.appointmentStatus || ''}</td>
                <td>${data.paymentStatus || ''}</td>
                <td>${data.payment || ''}</td>
                <td>${data.doctor || ''}</td>
            </tr>`;
        tbody.innerHTML += row;
    });

    // Ensure all relevant columns are shown by default for appointments view
    toggleColumns([
        'name', 
        'date', 
        'timestart', 
        'timeend', 
        'type of appointment', 
        'appointment status', 
        'doctor'
    ]);
  }

  // Sample appointments data (just an example)
  const appointments = [
      {
          id: '1',
          email: 'john.doe@example.com',
          firstName: 'John',
          middleName: 'Doe',
          surname: 'Smith',
          contact: '123-456-7890',
          appointmentDate: '2025-01-26',
          appointmentTimeStart: '14:00',
          appointmentTimeEnd: '15:00',
          appointmentType: 'Consultation',
          paymentType: 'Credit Card',
          appointmentStatus: 'Confirmed',
          paymentStatus: 'Paid',
          payment: '$100',
          doctor: 'Dr. Alice'
      },
      // More appointment objects can go here...
  ];

  // Print the sample appointments to the table
  printTable(appointments);
</script>

<script type="module" src="appoint.js"></script>

</body>
</html>