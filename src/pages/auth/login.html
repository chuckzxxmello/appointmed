<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login
    </title>
      
      <!-- Favicon and app icons -->
      <link rel="icon" href="../../assets/images/favicon.svg" type="image/svg+xml">
      <link rel="icon" href="../../assets/images/favicon.ico" type="image/x-icon">
      <link rel="apple-touch-icon" href="../../assets/images/apple-touch-icon.png">
      <link rel="icon" sizes="96x96" href="../../assets/images/favicon-96x96.png">
      <link rel="manifest" href="../../assets/images/site.webmanifest">

    <link rel="stylesheet" href="../../styles/stylesheet.css">
    
</head>

<body>

    <div class="bg-image"></div>
    <div class="header-cust">
        <nav>
            <h2>ELAD School of Potentials Therapy Center</h2>
            <ul>
                
                <li><a href="../contact_home.html" >Contact Us</a></li>
                <li><a href="../../../index.html">Home</a></li>
            </ul>
        </nav>
    </div>

        <div class="login-wrapper">
            <div class="login-container">
                <h2>Log-In</h2>
                <form id="auth">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input id="login-email" type="email" name="email" required />
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input id="login-password" type="password" name="password" required />
                        <button type="button" id="show-hide-login-password" style="color: #000000;" onclick="togglePassword('login-password', 'show-hide-login-password')">Show</button>
                    </div>

                    <div id="message" style="color: red; margin-top: 10px; text-align: center"></div>
                    <div id="loadingSpinner" class="loading" style="display: none;">Loading...</div>
        
                    <button id="submit" type="submit">Log-in</button>
                    <button type="button" onclick="signInWithGoogle()">Log-in with Google</button>
                </form>
                <h2>or</h2>
                <button id="switchToSignup" onclick="switchToSignup()">Create an Account</button>
            </div>
        
            <div class="signup-container" style="display: none;">
                <h2>Create your Account</h2>
                <form id="createAccountForm">
                    <div class="form-group">
                        <label for="signup-email">Email:</label>
                        <input id="signup-email" type="email" name="email" required />
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password:</label>
                        <input id="signup-password" type="password" name="password" required />
                        <button type="button" id="show-hide-signup-password" style="color: #000000;" onclick="togglePassword('signup-password', 'show-hide-signup-password')">Show</button>
                    </div>
            
                    <!-- Error message display for signup -->
                    <div id="signup-message" style="color: red; margin-top: 10px; text-align: center;"></div>
            
                    <div id="loadingSpinner" class="loading" style="display: none;">Loading...</div>
            
                    <button type="submit">Create Account</button>
            
                    <p id="signup-label" >By creating an account, you agree to our Terms & Service and Privacy Policy.</p>
                </form>
                <h2>or</h2>
                <button id="switchToLogin" onclick="switchToLogin()">Login Instead</button>
            </div>
            
            
        </div>

    <div class="footer">
        <div class="social-links">
            <a href="https://www.facebook.com/ELADSchoolofPotentials" class="footer-style-button">Facebook</a>
        </div>
        <p>&copy; 2025 ELAD School of Potentials Therapy Center</p>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    
        const firebaseConfig = {
            apiKey: "AIzaSyCZfi1aIc3zDdZD7NR7kN2Jm4hnCtPHWcQ", 
            authDomain: "appointment-scheduling-s-57d01.firebaseapp.com",
            databaseURL: "https://appointment-scheduling-s-57d01-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "appointment-scheduling-s-57d01",
            storageBucket: "appointment-scheduling-s-57d01.firebasestorage.app",
            messagingSenderId: "1069885306589",
            appId: "1:1069885306589:web:b31768194add4087754d34",
            measurementId: "G-KQ4PQZZZBM"
        };
    
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
    
        const handleLogin = (email, password) => {
            console.log("handleLogin called with:", email, password);
    
            // Check for admin credentials before trying Firebase login
            if (email === 'admin.control@mail.com' && password === 'adminXCZ457!@#') {
                window.location.href = '../manageuser/adminhome.html';
                return Promise.resolve();
            }
    
            return signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("User logged in: ", user);
                    window.location.href = 'userprofile.html'; 
                    return user; 
                })
                .catch(() => {
                    const customMessage = "Invalid email or password. Please try again.";
                    // Update the message div with the error message
                    const messageElement = document.getElementById('message');
                    if (messageElement) {
                        messageElement.textContent = customMessage;
                    }
                });
        };
    
        window.signInWithGoogle = function () {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider)
                .then((result) => {
                    const user = result.user;
                    console.log("User signed in: ", user);
                    window.location.href = 'userprofile.html'; 
                })
                .catch(() => {
                    const messageElement = document.getElementById('message');
                    if (messageElement) {
                        messageElement.textContent = "Error signing in with Google. Please try again.";
                    }
                });
        };
    
        const loginForm = document.getElementById('auth');
        loginForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            handleLogin(email, password);
        });
    
        const handleSignup = (event) => {
            console.log("Form submitted");
            event.preventDefault();  
    
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
    
            console.log(`Email: ${email}, Password: ${password}`); 
            createAccount(email, password); 
        };
    
        const createAccount = (email, password) => {
            console.log("Creating account..."); 
            createUserWithEmailAndPassword(auth, email, password)
                .then(() => {
                    window.location.href = 'userprofile.html'; 
                })
                .catch(() => {
                    const messageElement = document.getElementById('signup-message');
                    if (messageElement) {
                        messageElement.textContent = "There was an issue creating your account. Please try again.";
                    }
                });
        };
    
        document.getElementById('createAccountForm').addEventListener('submit', handleSignup);
    
        window.switchToSignup = function switchToSignup() {
            document.querySelector('.login-container').style.display = 'none';
            document.querySelector('.signup-container').style.display = 'block';
        };
    
        window.switchToLogin = function switchToLogin() {
            document.querySelector('.signup-container').style.display = 'none';
            document.querySelector('.login-container').style.display = 'block';
        };
    
        window.togglePassword = function togglePassword(passwordFieldId, buttonId) {
            const passwordField = document.getElementById(passwordFieldId);
            const showHideButton = document.getElementById(buttonId);
            if (passwordField.type === "password") {
                passwordField.type = "text";
                showHideButton.textContent = "Hide";
            } else {
                passwordField.type = "password";
                showHideButton.textContent = "Show";
            }
        };
    </script>
    
</body>
</html>
